<Patch>
  <!-- Only run if RimBees is loaded -->
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>RimBees</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- 1) Define a new stuff category once (safe if already present) -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/StuffCategoryDef[defName="SurvivalTools_Wax"]</xpath>
          <nomatch Class="PatchOperationAdd">
            <xpath>Defs</xpath>
            <value>
              <StuffCategoryDef>
                <defName>SurvivalTools_Wax</defName>
                <label>wax</label>
              </StuffCategoryDef>
            </value>
          </nomatch>
        </li>
        <!-- Helper: ensure a ThingDef has stuffProps/categories path -->
        <!-- We repeat the same ensure-then-add pattern per wax def for safety. -->
        <!-- 2) Tag RimBees waxes with the new category -->
        <!-- RB_Beeswax -->
        <li Class="PatchOperationSequence">
          <success>Always</success>
          <operations>
            <!-- ensure stuffProps exists -->
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="RB_Beeswax"]/stuffProps</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="RB_Beeswax"]</xpath>
                <value>
                  <stuffProps>
                    <categories/>
                  </stuffProps>
                </value>
              </nomatch>
            </li>
            <!-- ensure categories exists -->
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="RB_Beeswax"]/stuffProps/categories</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="RB_Beeswax"]/stuffProps</xpath>
                <value>
                  <categories/>
                </value>
              </nomatch>
            </li>
            <!-- add our category if missing -->
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="RB_Beeswax"]/stuffProps/categories/li[text()="SurvivalTools_Wax"]</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="RB_Beeswax"]/stuffProps/categories</xpath>
                <value>
                  <li>SurvivalTools_Wax</li>
                </value>
              </nomatch>
            </li>
          </operations>
        </li>
        <!-- RB_Brittlewax -->
        <li Class="PatchOperationSequence">
          <success>Always</success>
          <operations>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="RB_Brittlewax"]/stuffProps</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="RB_Brittlewax"]</xpath>
                <value>
                  <stuffProps>
                    <categories/>
                  </stuffProps>
                </value>
              </nomatch>
            </li>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="RB_Brittlewax"]/stuffProps/categories</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="RB_Brittlewax"]/stuffProps</xpath>
                <value>
                  <categories/>
                </value>
              </nomatch>
            </li>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="RB_Brittlewax"]/stuffProps/categories/li[text()="SurvivalTools_Wax"]</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="RB_Brittlewax"]/stuffProps/categories</xpath>
                <value>
                  <li>SurvivalTools_Wax</li>
                </value>
              </nomatch>
            </li>
          </operations>
        </li>
        <!-- RB_RedBeeswax -->
        <li Class="PatchOperationSequence">
          <success>Always</success>
          <operations>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="RB_RedBeeswax"]/stuffProps</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="RB_RedBeeswax"]</xpath>
                <value>
                  <stuffProps>
                    <categories/>
                  </stuffProps>
                </value>
              </nomatch>
            </li>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="RB_RedBeeswax"]/stuffProps/categories</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="RB_RedBeeswax"]/stuffProps</xpath>
                <value>
                  <categories/>
                </value>
              </nomatch>
            </li>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="RB_RedBeeswax"]/stuffProps/categories/li[text()="SurvivalTools_Wax"]</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="RB_RedBeeswax"]/stuffProps/categories</xpath>
                <value>
                  <li>SurvivalTools_Wax</li>
                </value>
              </nomatch>
            </li>
          </operations>
        </li>
        <!-- RB_WhiteBeeswax -->
        <li Class="PatchOperationSequence">
          <success>Always</success>
          <operations>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="RB_WhiteBeeswax"]/stuffProps</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="RB_WhiteBeeswax"]</xpath>
                <value>
                  <stuffProps>
                    <categories/>
                  </stuffProps>
                </value>
              </nomatch>
            </li>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="RB_WhiteBeeswax"]/stuffProps/categories</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="RB_WhiteBeeswax"]/stuffProps</xpath>
                <value>
                  <categories/>
                </value>
              </nomatch>
            </li>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="RB_WhiteBeeswax"]/stuffProps/categories/li[text()="SurvivalTools_Wax"]</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="RB_WhiteBeeswax"]/stuffProps/categories</xpath>
                <value>
                  <li>SurvivalTools_Wax</li>
                </value>
              </nomatch>
            </li>
          </operations>
        </li>
        <!-- RB_BlackBeeswax -->
        <li Class="PatchOperationSequence">
          <success>Always</success>
          <operations>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="RB_BlackBeeswax"]/stuffProps</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="RB_BlackBeeswax"]</xpath>
                <value>
                  <stuffProps>
                    <categories/>
                  </stuffProps>
                </value>
              </nomatch>
            </li>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="RB_BlackBeeswax"]/stuffProps/categories</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="RB_BlackBeeswax"]/stuffProps</xpath>
                <value>
                  <categories/>
                </value>
              </nomatch>
            </li>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="RB_BlackBeeswax"]/stuffProps/categories/li[text()="SurvivalTools_Wax"]</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="RB_BlackBeeswax"]/stuffProps/categories</xpath>
                <value>
                  <li>SurvivalTools_Wax</li>
                </value>
              </nomatch>
            </li>
          </operations>
        </li>
        <!-- 3) Allow your tools to accept that category (Axe, Pickaxe, Hammer, Sickle). 
               Add Multitool here too if you want waxable sci-fi madness. -->
        <!-- Helper sequence to ensure a tool has stuffCategories, then add our category if missing -->
        <!-- Axe -->
        <li Class="PatchOperationSequence">
          <success>Always</success>
          <operations>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="SurvivalTools_Axe"]/stuffCategories</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Axe"]</xpath>
                <value>
                  <stuffCategories/>
                </value>
              </nomatch>
            </li>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="SurvivalTools_Axe"]/stuffCategories/li[text()="SurvivalTools_Wax"]</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Axe"]/stuffCategories</xpath>
                <value>
                  <li>SurvivalTools_Wax</li>
                </value>
              </nomatch>
            </li>
          </operations>
        </li>
        <!-- Pickaxe -->
        <li Class="PatchOperationSequence">
          <success>Always</success>
          <operations>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="SurvivalTools_Pickaxe"]/stuffCategories</xpath>
              <xpath>Defs/ThingDef[defName="SurvivalTools_Pickaxe"]</xpath>
              <value>
                <stuffCategories/>
              </value>
            </li>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="SurvivalTools_Pickaxe"]/stuffCategories/li[text()="SurvivalTools_Wax"]</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Pickaxe"]/stuffCategories</xpath>
                <value>
                  <li>SurvivalTools_Wax</li>
                </value>
              </nomatch>
            </li>
          </operations>
        </li>
        <!-- Hammer -->
        <li Class="PatchOperationSequence">
          <success>Always</success>
          <operations>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="SurvivalTools_Hammer"]/stuffCategories</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Hammer"]</xpath>
                <value>
                  <stuffCategories/>
                </value>
              </nomatch>
            </li>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="SurvivalTools_Hammer"]/stuffCategories/li[text()="SurvivalTools_Wax"]</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Hammer"]/stuffCategories</xpath>
                <value>
                  <li>SurvivalTools_Wax</li>
                </value>
              </nomatch>
            </li>
          </operations>
        </li>
        <!-- Sickle -->
        <li Class="PatchOperationSequence">
          <success>Always</success>
          <operations>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="SurvivalTools_Sickle"]/stuffCategories</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Sickle"]</xpath>
                <value>
                  <stuffCategories/>
                </value>
              </nomatch>
            </li>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="SurvivalTools_Sickle"]/stuffCategories/li[text()="SurvivalTools_Wax"]</xpath>
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Sickle"]/stuffCategories</xpath>
                <value>
                  <li>SurvivalTools_Wax</li>
                </value>
              </nomatch>
            </li>
          </operations>
        </li>
        <!-- Uncomment if you want the Multitool to allow wax as well
        <li Class="PatchOperationSequence">
          <success>Always</success>
          <operations>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="SurvivalTools_Multitool"]/stuffCategories</xpath>
              
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Multitool"]</xpath>
                <value><stuffCategories/></value>
              </nomatch>
            </li>
            <li Class="PatchOperationConditional">
              <xpath>Defs/ThingDef[defName="SurvivalTools_Multitool"]/stuffCategories/li[text()="SurvivalTools_Wax"]</xpath>
              
              <nomatch Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Multitool"]/stuffCategories</xpath>
                <value><li>SurvivalTools_Wax</li></value>
              </nomatch>
            </li>
          </operations>
        </li>
        -->
      </operations>
    </match>
  </Operation>
</Patch>